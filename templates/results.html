{# results.html #}
{% extends "base.html" %}
{% from "components/stepper.html" import render_stepper %}
{% from "components/form_section.html" import render_form_section %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold mb-3">Digital Carbon Calculator</h1>
        <p class="text-xl text-base-content/70">Your Carbon Footprint Results</p>
    </div>

    {{ render_stepper(total_sections + 1, total_sections, visited_sections) }}

    <div class="max-w-2xl mx-auto">
        <div class="card w-full bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-2xl mb-6">Summary of Your Inputs</h2>

                {# Dynamically render each form section summary #}
                {% for section_key, section_data in collected_data.items() %}
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-primary mb-4">
                        {{ section_key | replace('_data', '') | replace('_', ' ') | title }}
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        {% for field_name, field_value in section_data.items() %}
                        <div class="text-base-content/70">
                            {{ field_name | replace('_', ' ') | title }}:
                        </div>
                        <div class="font-medium">
                            {% if field_value is number and field_name in ['bandwidth', 'amount'] %}
                            {{ field_value }} GB
                            {% elif field_value is number and field_name == 'cpu_usage' %}
                            {{ field_value }}%
                            {% else %}
                            {{ field_value | replace('_', ' ') | title }}
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}

                {# Carbon Footprint Results #}
                <div class="mt-8 p-6 bg-base-200 rounded-lg">
                    <h3 class="text-xl font-semibold text-primary mb-4">Estimated Carbon Footprint</h3>
                    <div class="stats stats-vertical lg:stats-horizontal shadow">
                        {% for metric, value in carbon_footprint.items() %}
                        <div class="stat">
                            <div class="stat-title">{{ metric | replace('_', ' ') | title }} CO2 Emissions</div>
                            <div class="stat-value text-primary">{{ value | round(2) }}</div>
                            <div class="stat-desc">kg CO2e</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="card-actions justify-end mt-8">
                    <a href="{{ url_for('step', step_number=1) }}" class="btn btn-outline">Start Over</a>
                    <button onclick="window.print()" class="btn btn-primary">Export Results</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}